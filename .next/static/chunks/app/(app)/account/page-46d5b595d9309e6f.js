(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{8042:function(e,s,a){Promise.resolve().then(a.bind(a,1926))},1926:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return S}});var n=a(7437),r=a(2265),l=a(3229),i=a(2489),t=a(2869),c=a(5186),o=a(6815),d=a(271),u=a(4508);let m=d.fC,f=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,n.jsx)(d.aV,{ref:s,className:(0,u.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});f.displayName=d.aV.displayName;let p=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,n.jsx)(d.xz,{ref:s,className:(0,u.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});p.displayName=d.xz.displayName;let x=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,n.jsx)(d.VY,{ref:s,className:(0,u.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});x.displayName=d.VY.displayName;var h=a(6070),v=a(5974),j=a(5510),g=a(1713),N=a(970);let b=(0,N.e)(),y=e=>({...e}),_={async getUserProfile(){let{data:{user:e}}=await b.auth.getUser();if(!e)return null;let{data:s,error:a}=await b.from("profiles").select("*").eq("id",e.id).maybeSingle();return a?(console.error("Error fetching user profile:",a),null):s?y(s):null}};var w=a(2759);function P(e){var s,a;let{credits:r}=e,{data:l,isLoading:i}=(0,g.a)({queryKey:["user-profile"],queryFn:_.getUserProfile,refetchInterval:3e4});if(i)return(0,n.jsx)(h.Zb,{className:"w-full",children:(0,n.jsx)(h.aY,{className:"p-4",children:(0,n.jsx)("div",{className:"animate-pulse h-4 bg-secondary rounded"})})});let t=void 0!==r?r:l&&null!==l.credits_limit&&null!==l.credits_used?l.credits_limit-l.credits_used:0;if(!l&&void 0===r)return(0,n.jsx)(h.Zb,{className:"w-full",children:(0,n.jsx)(h.aY,{className:"p-4",children:(0,n.jsx)("div",{className:"text-center text-muted-foreground",children:"Datos no disponibles"})})});let c=(null==l?void 0:l.plan_type)||"professional",o=(null==l?void 0:l.subscription_status)||"active",d=null!==(s=null==l?void 0:l.credits_used)&&void 0!==s?s:0,u=null!==(a=null==l?void 0:l.credits_limit)&&void 0!==a?a:100,m=u>0?d/u*100:0;return(0,n.jsxs)(h.Zb,{className:"w-full",children:[(0,n.jsx)(h.Ol,{className:"pb-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(h.ll,{className:"text-sm font-medium",children:"Estado de Suscripci\xf3n"}),(0,n.jsx)(v.C,{variant:"outline",className:(e=>{switch(e){case"active":return"bg-green-500";case"warning":return"bg-yellow-500";case"over_quota":return"bg-red-500";default:return"bg-gray-500"}})(o),children:(e=>{switch(e){case"active":return"Activo";case"warning":return"L\xedmite Pr\xf3ximo";case"over_quota":return"L\xedmite Alcanzado";default:return"Estado Desconocido"}})(o)})]})}),(0,n.jsx)(h.aY,{className:"pt-0",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsxs)("span",{children:["Plan ","professional"===c?"Profesional":"Cl\xednica"]}),(0,n.jsxs)("span",{children:[t," informes restantes"]})]}),(0,n.jsx)(w.E,{value:m,className:"h-2"}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,n.jsxs)("span",{children:[d," de ",u," utilizados"]}),(0,n.jsxs)("span",{children:[m.toFixed(1),"%"]})]}),"warning"===o&&(0,n.jsx)("div",{className:"text-xs text-yellow-600 bg-yellow-50 p-2 rounded",children:"⚠️ Te quedan pocos informes. Considera actualizar tu plan."}),"over_quota"===o&&(0,n.jsx)("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded",children:"\uD83D\uDEAB Has alcanzado tu l\xedmite. Actualiza tu plan para continuar."})]})})]})}var C=a(6281),E=a(4438),z=a(3464);function S(){let{user:e,profile:s,loading:a,updateProfile:d}=(0,C.a)(),[u,g]=(0,r.useState)({full_name:void 0,professional_license:void 0,clinic_name:void 0,password:""}),[b,y]=(0,r.useState)(!1),[_,w]=(0,r.useState)(!1),[S,A]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{s&&g({full_name:s.full_name||void 0,professional_license:s.professional_license||void 0,clinic_name:s.clinic_name||void 0,password:""})},[s]),a)return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-background",children:(0,n.jsx)("p",{children:"Cargando datos del usuario..."})});if(!e)return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-background",children:(0,n.jsx)("p",{children:"Debes estar autenticado para ver esta p\xe1gina."})});let k=(null==s?void 0:s.credits_limit)!=null&&(null==s?void 0:s.credits_used)!=null?s.credits_limit-s.credits_used:0,Z=(e,s)=>{g(a=>({...a,[e]:s}))},R=async()=>{y(!0);try{let e={full_name:u.full_name,professional_license:u.professional_license,clinic_name:u.clinic_name};if(await d(e),u.password&&u.password.length>0){if(u.password.length<6){E.Am.error("La contrase\xf1a debe tener al menos 6 caracteres."),y(!1);return}let e=(0,N.e)(),{error:s}=await e.auth.updateUser({password:u.password});s?(console.error("Error al actualizar la contrase\xf1a:",s),E.Am.error("Error al actualizar la contrase\xf1a: "+s.message)):(g(e=>({...e,password:""})),E.Am.success("Contrase\xf1a actualizada con \xe9xito."))}E.Am.success("Perfil actualizado correctamente.")}catch(e){console.error("Error al guardar el perfil:",e),E.Am.error(e.message||"Error al actualizar el perfil.")}finally{y(!1)}},D=async e=>{if((null==s?void 0:s.plan_type)===e){E.Am.info("Ya tienes este plan activo.");return}A(!0);try{let{url:s}=(await z.Z.post("/api/stripe/change-plan",{newPlanId:e})).data;if(s)window.location.href=s;else throw Error("No se recibi\xf3 la URL de Stripe.")}catch(e){var a,n;console.error("Error al cambiar de plan:",e),E.Am.error((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.error)||e.message||"Error al iniciar el cambio de plan.")}finally{A(!1)}},F=async()=>{let e=null==s?void 0:s.subscription_id;if(!e){E.Am.error("No se encontr\xf3 la suscripci\xf3n.");return}if(window.confirm("\xbfEst\xe1s seguro de que quieres cancelar tu suscripci\xf3n? Se mantendr\xe1 activa hasta el final del per\xedodo actual.")){w(!0);try{let s=await z.Z.post("/api/stripe/cancel-subscription",{subscriptionId:e});if(s.data.success)E.Am.success("Suscripci\xf3n cancelada. Se mantendr\xe1 activa hasta el final del per\xedodo actual.");else throw Error(s.data.error||"Error al cancelar la suscripci\xf3n.")}catch(e){var a,n;console.error("Error al cancelar la suscripci\xf3n:",e),E.Am.error((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.error)||e.message||"Error al cancelar la suscripci\xf3n.")}finally{w(!1)}}},q=async e=>{try{E.Am.info("Descargando factura...");let s=await z.Z.get("/api/stripe/download-invoice/".concat(e),{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=a,n.setAttribute("download","factura-".concat(e,".pdf")),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a),E.Am.success("Factura descargada")}catch(e){console.error("Error descargando factura:",e),E.Am.error("Error al descargar la factura.")}};return(0,n.jsxs)("div",{className:"flex min-h-screen flex-col bg-background",children:[(0,n.jsx)(j.B,{}),(0,n.jsx)("main",{className:"flex-1 px-4 py-8 lg:px-8",children:(0,n.jsx)("div",{className:"grid gap-6",children:(0,n.jsxs)(m,{defaultValue:"professional",children:[(0,n.jsxs)(f,{className:"grid w-full grid-cols-2",children:[(0,n.jsx)(p,{value:"professional",children:"Mis Datos Profesionales"}),(0,n.jsx)(p,{value:"subscription",children:"Suscripci\xf3n y Facturaci\xf3n"})]}),(0,n.jsx)(x,{value:"professional",className:"mt-6",children:(0,n.jsxs)(h.Zb,{children:[(0,n.jsxs)(h.Ol,{children:[(0,n.jsx)(h.ll,{className:"font-sans",children:"Informaci\xf3n Profesional"}),(0,n.jsx)(h.SZ,{className:"font-sans",children:"Gestiona tus datos profesionales."})]}),(0,n.jsx)(h.aY,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o._,{htmlFor:"full_name",className:"font-sans",children:"Nombre Completo *"}),(0,n.jsx)(c.I,{id:"full_name",value:u.full_name||"",onChange:e=>Z("full_name",e.target.value),placeholder:"Tu nombre completo"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o._,{htmlFor:"professional_license",className:"font-sans",children:"N\xfamero de Colegiado"}),(0,n.jsx)(c.I,{id:"professional_license",value:u.professional_license||"",onChange:e=>Z("professional_license",e.target.value),placeholder:"N\xfamero de colegiado"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o._,{htmlFor:"clinic_name",className:"font-sans",children:"Nombre del Centro"}),(0,n.jsx)(c.I,{id:"clinic_name",value:u.clinic_name||"",onChange:e=>Z("clinic_name",e.target.value),placeholder:"Nombre de tu cl\xednica"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o._,{htmlFor:"email",className:"font-sans",children:"Email (Login)"}),(0,n.jsx)(c.I,{id:"email",type:"email",value:e.email||"",disabled:!0,className:"bg-muted"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground font-sans",children:"El email no se puede cambiar. Es tu identificador de acceso."})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o._,{htmlFor:"password",className:"font-sans",children:"Contrase\xf1a"}),(0,n.jsx)(c.I,{id:"password",type:"password",value:u.password,onChange:e=>Z("password",e.target.value),placeholder:"Ingresa tu nueva contrase\xf1a"})]}),(0,n.jsxs)(t.z,{className:"font-sans",onClick:R,disabled:b,children:[(0,n.jsx)(l.Z,{className:"mr-2 h-4 w-4"}),b?"Guardando...":"Guardar Cambios"]})]})})]})}),(0,n.jsxs)(x,{value:"subscription",className:"mt-6",children:[(0,n.jsxs)(h.Zb,{children:[(0,n.jsxs)(h.Ol,{children:[(0,n.jsx)(h.ll,{className:"font-sans",children:"Tu Suscripci\xf3n"}),(0,n.jsx)(h.SZ,{className:"font-sans",children:"Gestiona tu plan y el estado de tu suscripci\xf3n."})]}),(0,n.jsx)(h.aY,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(v.C,{variant:"secondary",className:"font-sans text-xs px-3 py-1",children:(null==s?void 0:s.plan_type)==="professional"?"Plan Profesional":"Plan Cl\xednicas"}),(0,n.jsxs)("p",{className:"font-sans text-sm text-foreground",children:["Estado: ",(0,n.jsx)("span",{className:"font-medium text-green-500",children:"Activo"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o._,{className:"font-sans",children:"Cr\xe9ditos Restantes"}),(0,n.jsx)(P,{credits:k})]}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground font-sans",children:["Tienes ",(0,n.jsx)("b",{children:k})," informes restantes."]}),(0,n.jsxs)("div",{className:"pt-4 space-y-2",children:[(0,n.jsx)("h4",{className:"font-semibold",children:"Cambiar de Plan:"}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(t.z,{size:"sm",onClick:()=>D("professional"),disabled:S||(null==s?void 0:s.plan_type)==="professional",variant:(null==s?void 0:s.plan_type)==="professional"?"default":"outline",children:S?"Procesando...":"Plan Profesional"}),(0,n.jsx)(t.z,{size:"sm",onClick:()=>D("clinic"),disabled:S||(null==s?void 0:s.plan_type)==="clinic",variant:(null==s?void 0:s.plan_type)==="clinic"?"default":"outline",children:S?"Procesando...":"Plan Cl\xednicas"})]}),(0,n.jsxs)(t.z,{size:"sm",variant:"destructive",onClick:F,disabled:_,children:[(0,n.jsx)(i.Z,{className:"mr-2 h-4 w-4"}),_?"Cancelando...":"Cancelar Suscripci\xf3n"]})]})]})})]}),(0,n.jsxs)(h.Zb,{className:"mt-6",children:[(0,n.jsxs)(h.Ol,{children:[(0,n.jsx)(h.ll,{className:"font-sans",children:"Historial de Facturaci\xf3n"}),(0,n.jsx)(h.SZ,{className:"font-sans",children:"Descarga tus facturas y consulta el historial de pagos"})]}),(0,n.jsx)(h.aY,{children:(0,n.jsx)("div",{className:"max-h-60 overflow-y-auto pr-2",children:(0,n.jsxs)("div",{className:"space-y-3",children:[[{id:"inv_1",date:"23-08-2025",amount:"€99.00",description:"Suscripci\xf3n Plan Profesional",status:"Pagado"},{id:"inv_2",date:"23-09-2025",amount:"€99.00",description:"Suscripci\xf3n Plan Profesional",status:"Pagado"},{id:"inv_3",date:"23-10-2025",amount:"€99.00",description:"Suscripci\xf3n Plan Profesional",status:"Pagado"},{id:"inv_4",date:"23-11-2025",amount:"€99.00",description:"Suscripci\xf3n Plan Profesional",status:"Pagado"},{id:"inv_5",date:"23-12-2025",amount:"€99.00",description:"Suscripci\xf3n Plan Profesional",status:"Pagado"},{id:"inv_6",date:"24-01-2026",amount:"€99.00",description:"Suscripci\xf3n Plan Profesional",status:"Pagado"}].map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-border last:border-0",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-sans text-sm font-medium",children:e.description}),(0,n.jsx)("p",{className:"font-sans text-xs text-muted-foreground",children:e.date})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{className:"font-sans text-sm font-medium",children:e.amount}),(0,n.jsx)(t.z,{variant:"outline",size:"sm",className:"font-sans",onClick:()=>q(e.id),children:"Descargar"})]})]},e.id)),(0,n.jsx)("p",{className:"text-center text-muted-foreground font-sans",children:"A\xfan no tienes facturas."})]})})})]})]})]})})})]})}},6815:function(e,s,a){"use strict";a.d(s,{_:function(){return o}});var n=a(7437),r=a(2265),l=a(6394),i=a(535),t=a(4508);let c=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,n.jsx)(l.f,{ref:s,className:(0,t.cn)(c(),a),...r})});o.displayName=l.f.displayName},2759:function(e,s,a){"use strict";a.d(s,{E:function(){return t}});var n=a(7437),r=a(2265),l=a(610),i=a(4508);let t=r.forwardRef((e,s)=>{let{className:a,value:r,...t}=e;return(0,n.jsx)(l.fC,{ref:s,className:(0,i.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...t,children:(0,n.jsx)(l.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});t.displayName=l.fC.displayName}},function(e){e.O(0,[545,582,990,452,630,763,849,438,713,231,53,971,117,744],function(){return e(e.s=8042)}),_N_E=e.O()}]);