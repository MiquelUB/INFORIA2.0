(()=>{var e={};e.id=192,e.ids=[192],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},3965:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>d,routeModule:()=>m,tree:()=>c}),a(3354),a(6979),a(5866),a(7449);var r=a(3191),o=a(8716),s=a(7922),i=a.n(s),n=a(5231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);a.d(t,l);let c=["",{children:["(app)",{children:["session",{children:["[patientId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,3354)),"D:\\iNFORiA\\SaaS\\INFORIA2.0\\app\\(app)\\session\\[patientId]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,6979)),"D:\\iNFORiA\\SaaS\\INFORIA2.0\\app\\(app)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,7449)),"D:\\iNFORiA\\SaaS\\INFORIA2.0\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],d=["D:\\iNFORiA\\SaaS\\INFORIA2.0\\app\\(app)\\session\\[patientId]\\page.tsx"],p="/(app)/session/[patientId]/page",u={require:a,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/(app)/session/[patientId]/page",pathname:"/session/[patientId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1776:(e,t,a)=>{Promise.resolve().then(a.bind(a,7013))},7013:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>L});var r=a(326),o=a(7577),s=a(5047),i=a(3071),n=a(772),l=a(7673),c=a(567),d=a(6283),p=a(2881);let u=(0,p.Z)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),m=(0,p.Z)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);var h=a(8091),g=a(1215);let f=(0,p.Z)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var x=a(949),w=a(7358),y=a(7027),v=a(5999),N=a(2132);let b=(0,p.Z)("file-audio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]),E=(0,p.Z)("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),I=(0,p.Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var A=a(4019),j=a(7863);let S=({files:e,onFilesSelected:t,onFileRemove:a,acceptedTypes:s=".wav,.mp3,.m4a,.txt,.pdf,.doc,.docx",maxFiles:l=10,isDisabled:p=!1,className:u})=>{let m=(0,o.useRef)(null),h=e=>e.type.startsWith("audio/")?r.jsx(b,{className:"w-4 h-4"}):e.type.startsWith("text/")||e.name.endsWith(".txt")?r.jsx(d.Z,{className:"w-4 h-4"}):r.jsx(E,{className:"w-4 h-4"}),g=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]};return(0,r.jsxs)("div",{className:(0,j.cn)("space-y-4",u),children:[r.jsx(i.Zb,{className:(0,j.cn)("border-2 border-dashed cursor-pointer transition-colors",p?"border-gray-300 cursor-not-allowed":"border-gray-400 hover:border-primary",e.length>=l&&"cursor-not-allowed opacity-50"),onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();let a=e.dataTransfer.files;a.length>0&&t(a)},onClick:!p&&e.length<l?()=>{m.current?.click()}:void 0,children:(0,r.jsxs)(i.aY,{className:"p-8 text-center",children:[r.jsx(I,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),r.jsx("p",{className:"text-lg font-medium mb-2",children:"Seleccionar archivos"}),r.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Arrastra archivos aqu\xed o haz clic para seleccionar"}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["Tipos permitidos: ",s]})]})}),r.jsx("input",{ref:m,type:"file",multiple:!0,accept:s,onChange:e=>{let a=e.target.files;a&&a.length>0&&t(a),m.current&&(m.current.value="")},className:"hidden",disabled:p||e.length>=l}),e.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h4",{className:"font-medium text-sm",children:["Archivos seleccionados (",e.length,")"]}),e.map((e,t)=>r.jsx(i.Zb,{className:"p-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[h(e),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium truncate max-w-[200px]",children:e.name}),r.jsx("p",{className:"text-xs text-gray-500",children:g(e.size)})]}),r.jsx(c.C,{variant:"outline",className:"ml-2",children:e.type.split("/")[0]})]}),r.jsx(n.z,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),a(t)},className:"text-red-500 hover:text-red-700",children:r.jsx(A.Z,{className:"w-4 h-4"})})]})},t))]})]})},C=(e,t)=>{let[a,r]=(0,o.useState)([]),[s,i]=(0,o.useState)(!1),n=(0,o.useCallback)(t=>{let a=new Date,r=a.toISOString().split("T")[0].replace(/-/g,""),o=a.toTimeString().split(" ")[0].replace(/:/g,""),s=e||"XX",i=t.split(".").pop();return`${r}_${o}_${s}.${i}`},[e]);return{selectedFiles:a,isUploading:s,uploadFiles:(0,o.useCallback)(async e=>{i(!0);try{let a=Array.from(e).map(e=>{let t=n(e.name);return new File([e],t,{type:e.type})});r(e=>[...e,...a]),t?.(a),v.Am.success(`${a.length} archivo(s) seleccionado(s)`)}catch(e){console.error("Error uploading files:",e),v.Am.error("Error al procesar archivos")}finally{i(!1)}},[n,t]),removeFile:(0,o.useCallback)(e=>{r(t=>t.filter((t,a)=>a!==e))},[]),clearFiles:(0,o.useCallback)(()=>{r([])},[])}},T=(e,t)=>{let[a,r]=(0,o.useState)(!1),[s,i]=(0,o.useState)("00:00"),[n,l]=(0,o.useState)(null),c=(0,o.useRef)(null),d=(0,o.useRef)(null),p=(0,o.useRef)(null),u=(0,o.useRef)(0),m=(0,o.useCallback)(()=>{let t=new Date,a=t.toISOString().split("T")[0].replace(/-/g,""),r=t.toTimeString().split(" ")[0].replace(/:/g,""),o=e||"XX";return`${a}_${r}_${o}_session.wav`},[e]),h=(0,o.useCallback)(()=>{let e=Date.now()-u.current;i(`${Math.floor(e/6e4).toString().padStart(2,"0")}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`)},[]),g=(0,o.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});d.current=e;let a=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});c.current=a;let o=[];a.ondataavailable=e=>{e.data.size>0&&o.push(e.data)},a.onstop=()=>{let e=new Blob(o,{type:"audio/wav"});l(e);let a=m();t?.(e,a),d.current&&(d.current.getTracks().forEach(e=>e.stop()),d.current=null)},a.start(1e3),r(!0),u.current=Date.now(),p.current=setInterval(h,1e3),v.Am.success("Grabaci\xf3n iniciada")}catch(e){console.error("Error accessing microphone:",e),v.Am.error("Error al acceder al micr\xf3fono. Verifica los permisos.")}},[m,t,h]),f=(0,o.useCallback)(()=>{c.current&&a&&(c.current.stop(),r(!1),p.current&&(clearInterval(p.current),p.current=null),v.Am.success("Grabaci\xf3n finalizada"))},[a]),x=(0,o.useCallback)(()=>{l(null),i("00:00"),v.Am.success("Grabaci\xf3n eliminada")},[]),w=(0,o.useCallback)(()=>{n&&new Audio(URL.createObjectURL(n)).play()},[n]);return{isRecording:a,recordingTime:s,audioBlob:n,startRecording:g,stopRecording:f,deleteRecording:x,playRecording:w}};var R=a(3136),k=a(5379),O=a(2945);let $=(0,O.e)();class D{static{this.FOLDER_NAME="iNFORiA_INFORMES"}static{this.SCOPES=["https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.folders","https://www.googleapis.com/auth/documents"]}async getAccessToken(){try{let{data:{session:e},error:t}=await $.auth.getSession();if(t||!e?.provider_token)return console.error("No hay token de Google disponible:",t),null;return e.provider_token}catch(e){return console.error("Error obteniendo token:",e),null}}async hasPermissions(){let e=await this.getAccessToken();if(!e)return!1;try{return(await fetch("https://www.googleapis.com/drive/v3/about?fields=user",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).ok}catch(e){return console.error("Error verificando permisos de Drive:",e),!1}}async getOrCreateInforiaFolder(){let e=await this.getAccessToken();if(!e)return null;try{let t=await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${D.FOLDER_NAME}' and mimeType='application/vnd.google-apps.folder' and trashed=false`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw Error("Error buscando carpeta iNFORiA_INFORMES");let a=await t.json();if(a.files&&a.files.length>0)return a.files[0].id;let r=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({name:D.FOLDER_NAME,mimeType:"application/vnd.google-apps.folder"})});if(!r.ok)throw Error("Error creando carpeta iNFORiA_INFORMES");let o=await r.json();return console.log("✅ Carpeta iNFORiA_INFORMES creada:",o.id),o.id}catch(e){return console.error("Error gestionando carpeta iNFORiA_INFORMES:",e),null}}async getOrCreatePatientFolder(e,t){let a=await this.getAccessToken();if(!a)return null;try{let r=await this.getOrCreateInforiaFolder();if(!r)return null;let o=e.replace(/[<>:"/\\|?*]/g,"_").trim(),s=`${o}_${t.substring(0,8)}`,i=await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${s}' and '${r}' in parents and mimeType='application/vnd.google-apps.folder' and trashed=false`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!i.ok)throw Error("Error buscando carpeta del paciente");let n=await i.json();if(n.files&&n.files.length>0)return n.files[0].id;let l=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({name:s,parents:[r],mimeType:"application/vnd.google-apps.folder"})});if(!l.ok)throw Error("Error creando carpeta del paciente");let c=await l.json();return console.log("✅ Carpeta del paciente creada en iNFORiA_INFORMES:",c.id),c.id}catch(e){return console.error("Error gestionando carpeta del paciente:",e),null}}async createPatientReport(e,t,a,r){try{let o=await this.getAccessToken();if(!o)return{fileId:"",webViewLink:"",success:!1,message:"No tienes permisos de Google Drive. Re-autentica tu cuenta."};let s=await this.getOrCreatePatientFolder(a,r);if(!s)return{fileId:"",webViewLink:"",success:!1,message:"Error creando carpeta del paciente"};let i=new Date().toISOString().split("T")[0],n=`${i} - ${e}`,l=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({name:n,parents:[s],mimeType:"application/vnd.google-apps.document"})});if(!l.ok)throw Error("Error creando documento en Drive");let c=await l.json(),d=[{insertText:{location:{index:1},text:`${e}

${t}`}},{updateTextStyle:{range:{startIndex:1,endIndex:e.length+1},textStyle:{bold:!0,fontSize:{magnitude:16,unit:"PT"}},fields:"bold,fontSize"}}];return(await fetch(`https://docs.googleapis.com/v1/documents/${c.id}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({requests:d})})).ok||console.warn("Documento creado pero error al formatear contenido"),console.log("✅ Informe guardado en carpeta del paciente:",c.id),{fileId:c.id,webViewLink:`https://docs.google.com/document/d/${c.id}/edit`,success:!0,message:"Informe guardado exitosamente en Google Drive"}}catch(e){return console.error("Error creando documento en Drive:",e),{fileId:"",webViewLink:"",success:!1,message:e instanceof Error?e.message:"Error desconocido"}}}async createReport(e,t){try{let a=await this.getAccessToken();if(!a)return{fileId:"",webViewLink:"",success:!1,message:"No tienes permisos de Google Drive. Re-autentica tu cuenta."};let r=await this.getOrCreateInforiaFolder();if(!r)return{fileId:"",webViewLink:"",success:!1,message:"Error accediendo a la carpeta de informes"};let o={name:`${e}.gdoc`,parents:[r],mimeType:"application/vnd.google-apps.document"},s=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!s.ok)throw Error("Error creando documento en Drive");let i=await s.json(),n=[{insertText:{location:{index:1},text:`${e}

${t}`}},{updateTextStyle:{range:{startIndex:1,endIndex:e.length+1},textStyle:{bold:!0,fontSize:{magnitude:16,unit:"PT"}},fields:"bold,fontSize"}}];return(await fetch(`https://docs.googleapis.com/v1/documents/${i.id}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({requests:n})})).ok||console.warn("Documento creado pero error al formatear contenido"),console.log("✅ Informe guardado en Google Drive:",i.id),{fileId:i.id,webViewLink:`https://docs.google.com/document/d/${i.id}/edit`,success:!0,message:"Informe guardado exitosamente en Google Drive"}}catch(e){return console.error("Error creando documento en Drive:",e),{fileId:"",webViewLink:"",success:!1,message:e instanceof Error?e.message:"Error desconocido"}}}async listReports(){try{let e=await this.getAccessToken();if(!e)return[];let t=await this.getOrCreateInforiaFolder();if(!t)return[];let a=await fetch(`https://www.googleapis.com/drive/v3/files?q='${t}' in parents and mimeType='application/vnd.google-apps.document' and trashed=false&fields=files(id,name,webViewLink,webContentLink,createdTime)&orderBy=createdTime desc`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!a.ok)throw Error("Error listando informes");return(await a.json()).files||[]}catch(e){return console.error("Error listando informes:",e),[]}}async listPatientReports(e,t){try{let a=await this.getAccessToken();if(!a)return[];let r=await this.getOrCreatePatientFolder(e,t);if(!r)return[];let o=await fetch(`https://www.googleapis.com/drive/v3/files?q='${r}' in parents and mimeType='application/vnd.google-apps.document' and trashed=false&fields=files(id,name,webViewLink,webContentLink,createdTime)&orderBy=createdTime desc`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!o.ok)throw Error("Error listando informes del paciente");return(await o.json()).files||[]}catch(e){return console.error("Error listando informes del paciente:",e),[]}}async checkFileExists(e){try{let t=await this.getAccessToken();if(!t)return!1;let a=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?fields=id,trashed`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!a.ok)return!1;return!(await a.json()).trashed}catch(e){return console.error("Error verificando archivo:",e),!1}}async requestPermissions(){try{let{error:e}=await $.auth.signInWithOAuth({provider:"google",options:{scopes:D.SCOPES.join(" "),redirectTo:`${window.location.origin}/`,queryParams:{access_type:"offline",prompt:"consent"}}});if(e)return console.error("Error solicitando permisos:",e),!1;return!0}catch(e){return console.error("Error en requestPermissions:",e),!1}}async getPatientFolderUrl(e,t){try{let a=await this.getOrCreatePatientFolder(e,t);if(!a)return null;return`https://drive.google.com/drive/folders/${a}`}catch(e){return console.error("Error obteniendo URL de carpeta del paciente:",e),null}}}let P=new D,_=(0,O.e)();class M{static{this.CRM_SHEET_NAME="iNFORiA_CRM_PACIENTES"}async getAccessToken(){try{let{data:{session:e},error:t}=await _.auth.getSession();if(t||!e?.provider_token)return console.error("No hay token de Google disponible:",t),null;return e.provider_token}catch(e){return console.error("Error obteniendo token:",e),null}}async getOrCreateCRMSheet(){try{let e=await this.getAccessToken();if(!e)return null;let t=await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${M.CRM_SHEET_NAME}' and mimeType='application/vnd.google-apps.spreadsheet' and trashed=false`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw Error("Error buscando CRM Sheet");let a=await t.json();if(a.files&&a.files.length>0)return a.files[0].id;let r=await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:M.CRM_SHEET_NAME},sheets:[{properties:{title:"Pacientes"}},{properties:{title:"Pagos"}},{properties:{title:"Informes"}}]})});if(!r.ok)throw Error("Error creando CRM Sheet");let o=(await r.json()).spreadsheetId;return await this.setupPatientsSheet(o),await this.setupPaymentsSheet(o),await this.setupReportsSheet(o),console.log("✅ CRM Sheet creado:",o),o}catch(e){return console.error("Error gestionando CRM Sheet:",e),null}}async setupPatientsSheet(e){let t=await this.getAccessToken();if(t)try{await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${e}/values/Pacientes!A1:N1?valueInputOption=RAW`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({values:[["ID","Nombre Completo","Email","Tel\xe9fono","Fecha Nacimiento","Fecha Alta","Total Informes","\xdaltimo Informe","Estado Pago","Total Pagado €","Pr\xf3ximo Pago","Estado Paciente","Notas","Carpeta Drive"]]})}),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${e}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{repeatCell:{range:{sheetId:0,startRowIndex:0,endRowIndex:1,startColumnIndex:0,endColumnIndex:14},cell:{userEnteredFormat:{backgroundColor:{red:.18,green:.25,blue:.23},textFormat:{foregroundColor:{red:1,green:1,blue:1},bold:!0}}},fields:"userEnteredFormat"}}]})})}catch(e){console.error("Error configurando hoja Pacientes:",e)}}async setupPaymentsSheet(e){let t=await this.getAccessToken();if(t)try{await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${e}/values/Pagos!A1:H1?valueInputOption=RAW`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({values:[["Fecha","ID Paciente","Nombre Paciente","Concepto","Cantidad €","M\xe9todo Pago","Estado","Notas"]]})}),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${e}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{repeatCell:{range:{sheetId:1,startRowIndex:0,endRowIndex:1,startColumnIndex:0,endColumnIndex:8},cell:{userEnteredFormat:{backgroundColor:{red:.5,green:0,blue:.125},textFormat:{foregroundColor:{red:1,green:1,blue:1},bold:!0}}},fields:"userEnteredFormat"}}]})})}catch(e){console.error("Error configurando hoja Pagos:",e)}}async setupReportsSheet(e){let t=await this.getAccessToken();if(t)try{await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${e}/values/Informes!A1:H1?valueInputOption=RAW`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({values:[["Fecha","ID Paciente","Nombre Paciente","Tipo Informe","T\xedtulo","Estado","Link Google Docs","M\xe9todo Input"]]})})}catch(e){console.error("Error configurando hoja Informes:",e)}}async upsertPatientInCRM(e,t){try{let a=await this.getAccessToken();if(!a)return!1;let r=t||await this.getOrCreateCRMSheet();if(!r)return!1;let o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r}/values/Pacientes!A:A`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!o.ok)throw Error("Error buscando pacientes en CRM");let s=(await o.json()).values||[],i=-1;for(let t=1;t<s.length;t++)if(s[t][0]===e.id){i=t+1;break}let n=[e.id,e.name,e.email||"",e.phone||"",e.birth_date||"",e.created_at,e.total_reports.toString(),e.last_report_date||"",e.payment_status,e.total_paid.toString(),e.next_payment_due||"",e.status,e.notes||"",e.drive_folder_url||""];if(i>0)await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r}/values/Pacientes!A${i}:N${i}?valueInputOption=RAW`,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({values:[n]})});else{let e=s.length+1;await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r}/values/Pacientes!A${e}:N${e}?valueInputOption=RAW`,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({values:[n]})})}return console.log("✅ Paciente actualizado en CRM:",e.name),!0}catch(e){return console.error("Error actualizando paciente en CRM:",e),!1}}async addReportToCRM(e,t){try{let a=await this.getAccessToken();if(!a)return!1;let r=t||await this.getOrCreateCRMSheet();if(!r)return!1;let o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r}/values/Informes!A:A`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!o.ok)throw Error("Error obteniendo datos de informes");let s=await o.json(),i=(s.values?.length||0)+1,n=[e.date,e.patientId,e.patientName,e.reportType,e.title,e.status,e.driveLink,e.inputMethod];return await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r}/values/Informes!A${i}:H${i}?valueInputOption=RAW`,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({values:[n]})}),console.log("✅ Informe agregado al CRM"),!0}catch(e){return console.error("Error agregando informe al CRM:",e),!1}}async addPaymentToCRM(e,t){try{let a=await this.getAccessToken();if(!a)return!1;let r=t||await this.getOrCreateCRMSheet();if(!r)return!1;let o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r}/values/Pagos!A:A`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!o.ok)throw Error("Error obteniendo datos de pagos");let s=await o.json(),i=(s.values?.length||0)+1,n=[e.date,e.patientId,e.patientName,e.concept,e.amount.toString(),e.paymentMethod,e.status,e.notes||""];return await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r}/values/Pagos!A${i}:H${i}?valueInputOption=RAW`,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({values:[n]})}),console.log("✅ Pago agregado al CRM"),!0}catch(e){return console.error("Error agregando pago al CRM:",e),!1}}getCRMViewUrl(e){return`https://docs.google.com/spreadsheets/d/${e}/edit`}}let F=new M;class z{constructor(){this.baseUrl="https://openrouter.ai/api/v1",this.apiKey=process.env.NEXT_PUBLIC_OPENROUTER_API_KEY||"",this.apiKey||console.warn("⚠️ OPENROUTER_API_KEY no configurada")}async transcribeAudio(e){try{let t=new FormData;t.append("file",e,"session_audio.wav"),t.append("model","whisper-1"),t.append("response_format","json"),t.append("language","es"),t.append("prompt","Esta es una sesi\xf3n terap\xe9utica en espa\xf1ol. Incluye t\xe9rminos psicol\xf3gicos y m\xe9dicos.");let a=await fetch(`${this.baseUrl}/audio/transcriptions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"HTTP-Referer":window.location.origin,"X-Title":"INFORIA Clinical Assistant"},body:t});if(!a.ok){let e=await a.text();throw Error(`Whisper transcription error: ${a.status} ${a.statusText} - ${e}`)}return(await a.json()).text}catch(e){throw console.error("Error en transcripci\xf3n de audio:",e),Error(e instanceof Error?e.message:"Error desconocido en transcripci\xf3n")}}async compileReportInfo(e){return({nuevo_paciente:`
TIPO: PRIMER INFORME - PACIENTE NUEVO
Paciente: ${e.patientData.name}
Edad: ${e.patientData.age||"No especificada"}
Fecha de consulta: ${e.sessionData.sessionDate}

TRANSCRIPCI\xd3N DE AUDIO:
${e.sessionData.audioTranscription||"No disponible"}

NOTAS CL\xcdNICAS:
${e.sessionData.clinicalNotes}

INSTRUCCIONES:
Genera un primer informe completo que incluya:
1. Anamnesis inicial completa
2. Motivo de consulta principal
3. Historia cl\xednica relevante
4. Exploraci\xf3n psicopatol\xf3gica
5. Impresi\xf3n diagn\xf3stica inicial
6. Plan de tratamiento propuesto
7. Objetivos terap\xe9uticos

Formato: Informe cl\xednico profesional en markdown
`,seguimiento:`
TIPO: INFORME DE SEGUIMIENTO
Paciente: ${e.patientData.name}
Fecha actual: ${e.sessionData.sessionDate}
Primera visita: ${e.patientData.firstVisitDate||"No registrada"}

TRANSCRIPCI\xd3N SESI\xd3N ACTUAL:
${e.sessionData.audioTranscription||"No disponible"}

NOTAS SESI\xd3N ACTUAL:
${e.sessionData.clinicalNotes}

INFORMES PREVIOS:
${e.patientData.previousReports?.join("\n---\n")||"No disponibles"}

INSTRUCCIONES:
Genera un informe de seguimiento que incluya:
1. Evoluci\xf3n desde la \xfaltima sesi\xf3n
2. Progreso en objetivos terap\xe9uticos
3. Nuevas observaciones cl\xednicas
4. Cambios en el estado mental
5. Adherencia al tratamiento
6. Ajustes al plan terap\xe9utico
7. Pr\xf3ximos pasos y recomendaciones

Compara con informes previos y destaca cambios significativos.
Formato: Informe evolutivo en markdown
`,alta_paciente:`
TIPO: DOSSIER DE ALTA - INFORME FINAL
Paciente: ${e.patientData.name}
Inicio tratamiento: ${e.patientData.firstVisitDate||"No registrado"}
Fecha de alta: ${e.sessionData.sessionDate}

TRANSCRIPCI\xd3N SESI\xd3N FINAL:
${e.sessionData.audioTranscription||"No disponible"}

NOTAS FINALES:
${e.sessionData.clinicalNotes}

HISTORIAL COMPLETO:
${e.patientData.previousReports?.join("\n---\n")||"No disponible"}

INSTRUCCIONES:
Genera un dossier completo de alta que incluya:
1. RESUMEN EJECUTIVO del caso completo
2. EVOLUCI\xd3N CRONOL\xd3GICA del tratamiento
3. OBJETIVOS ALCANZADOS y pendientes
4. DIAGN\xd3STICO FINAL y pron\xf3stico
5. HERRAMIENTAS Y T\xc9CNICAS utilizadas
6. RECOMENDACIONES POST-ALTA
7. PLAN DE SEGUIMIENTO (si aplica)
8. RECURSOS Y DERIVACIONES sugeridas

Este debe ser un informe integral y definitivo.
Formato: Dossier profesional completo en markdown
`})[e.reportType]}async generateReport(e,t="nuevo_paciente",a="deepseek/deepseek-r1"){try{let r=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"INFORIA Clinical Assistant"},body:JSON.stringify({model:a,messages:[{role:"system",content:{nuevo_paciente:"Eres un psic\xf3logo cl\xednico experto con 20+ a\xf1os de experiencia. Generas informes profesionales, precisos y emp\xe1ticos para primeras consultas.",seguimiento:"Eres un psic\xf3logo cl\xednico especializado en seguimiento terap\xe9utico. Eval\xfaas evoluci\xf3n y progresos con criterio profesional.",alta_paciente:"Eres un psic\xf3logo cl\xednico con expertise en cierres de tratamiento. Generas dossiers completos de alta con visi\xf3n integral del proceso."}[t]},{role:"user",content:e}],max_tokens:3e3,temperature:.7,top_p:.9})});if(!r.ok){let e=await r.text();throw Error(`Report generation error: ${r.status} ${r.statusText} - ${e}`)}let o=await r.json();return o.choices[0]?.message?.content||"Error al generar el informe"}catch(e){throw console.error("Error en generaci\xf3n de informe:",e),Error(e instanceof Error?e.message:"Error desconocido en generaci\xf3n de informe")}}async processFullReport(e){try{let t=await this.compileReportInfo(e);return await this.generateReport(t,e.reportType,e.selectedModel||"deepseek/deepseek-r1")}catch(e){throw console.error("Error en procesamiento completo:",e),Error(e instanceof Error?e.message:"Error en procesamiento del informe")}}async testConnection(){try{return(await fetch(`${this.baseUrl}/models`,{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`,"HTTP-Referer":window.location.origin}})).ok}catch{return!1}}}let B=new z;function L({params:e}){let t=(0,s.useRouter)(),{user:a}=(0,R.a)(),[p,b]=(0,o.useState)(null),[E,I]=(0,o.useState)(""),[A,j]=(0,o.useState)("primera_visita"),[O,$]=(0,o.useState)(!1),[D,_]=(0,o.useState)(!1),[M,z]=(0,o.useState)(""),[L,G]=(0,o.useState)(null),[U,q]=(0,o.useState)("unknown"),[V,Z]=(0,o.useState)("unknown"),[H,J]=(0,o.useState)([]);e.patientId;let W=p?p.name.split(" ").map(e=>e[0]).join("").toUpperCase():void 0,{selectedFiles:Y,uploadFiles:K,removeFile:X,clearFiles:Q}=C(W),{isRecording:ee,recordingTime:et,audioBlob:ea,startRecording:er,stopRecording:eo,deleteRecording:es,playRecording:ei}=T(W),en=async()=>{console.log("\uD83E\uDDEA Testing OpenRouter connectivity...");let e=(void 0).VITE_OPENROUTER_API_KEY;console.log("\uD83D\uDD11 API Key debug info:",{exists:!!e,length:e?.length,firstChars:e?.substring(0,15),lastChars:e?.substring(e?.length-5),hasNewlines:e?.includes("\n"),hasSpaces:e?.includes(" "),hasTabs:e?.includes("	"),isString:typeof e});try{console.log("\uD83C\uDF10 Attempting fetch to OpenRouter...");let t=e?.trim(),a={Authorization:`Bearer ${t}`,"Content-Type":"application/json"};console.log("\uD83D\uDCCB Headers debug:",{authHeaderLength:a.Authorization?.length,authStarts:a.Authorization?.substring(0,20),contentType:a["Content-Type"]});let r=await fetch("https://openrouter.ai/api/v1/models",{method:"GET",headers:a});if(console.log("\uD83D\uDCE1 OpenRouter response:",{status:r.status,ok:r.ok,statusText:r.statusText}),r.ok){let e=await r.json();return console.log("✅ OpenRouter conectado - Modelos:",e.data?.length||0),!0}{let e=await r.text();return console.log("❌ OpenRouter error response:",e),!1}}catch(e){return console.log("❌ Fetch exception details:",{name:e.name,message:e.message,stack:e.stack?.substring(0,200)}),!1}},el=(e,t)=>`# ${e}

## INFORMACI\xd3N DE LA SESI\xd3N
- **Fecha**: ${t}
- **Paciente**: ${p?.name}
- **Tipo de consulta**: ${ed(A)}
- **Profesional**: ${a?.email}

## DESARROLLO DE LA SESI\xd3N

${E.trim()?`### Observaciones Cl\xednicas
${E.trim()}

`:""}

${M?`### Registro de Audio
${M}

`:""}

${Y.length>0?`### Documentaci\xf3n Adjunta
${Y.map((e,t)=>`${t+1}. ${e.name} (${Math.round(e.size/1024)} KB)`).join("\n")}

`:""}

## EVALUACI\xd3N Y SEGUIMIENTO

### Estado Actual
- Sesi\xf3n documentada completamente
- ${ea?"Incluye grabaci\xf3n de audio":"Sesi\xf3n basada en notas escritas"}
- ${Y.length>0?`${Y.length} documento(s) adicional(es)`:"Sin documentaci\xf3n adicional"}

### Pr\xf3ximos Pasos
- Revisar contenido de la sesi\xf3n
- ${"primera_visita"===A?"Planificar seguimiento inicial":"Continuar con plan terap\xe9utico establecido"}
- Actualizar historial cl\xednico

---
*Informe generado autom\xe1ticamente el ${new Date().toLocaleString()}*
*Sistema: iNFORiA Clinical Assistant*`,ec=async()=>{if(!p||!E.trim()&&!M.trim()&&0===Y.length){v.Am.error("Por favor proporciona contenido para el informe");return}$(!0);try{let e,t;console.log("\uD83D\uDE80 Generando informe con sistema h\xedbrido IA/Estructurado:",{patient:p.name,type:A,hasAudio:!!ea,hasTranscription:!!M,filesCount:Y.length,notesLength:E.length});let r=new Date().toISOString().split("T")[0],o=`${ed(A)} - ${p.name} - ${r}`,s="structured";if(E.trim()||M.trim())try{if(console.log("\uD83E\uDD16 Intentando generar informe con IA..."),!await en())throw Error("OpenRouter no disponible - usando fallback estructurado");let t="seguimiento"===A?await k.qi.getByPatient(p.id):[],a={name:p.name,age:p.birth_date?Math.floor((Date.now()-new Date(p.birth_date).getTime())/315576e5):void 0,previousReports:t.map(e=>e.content||"").slice(0,3),firstVisitDate:p.created_at||void 0},o={audioTranscription:M||void 0,clinicalNotes:E.trim(),sessionDate:r},i=await B.compileReportInfo({reportType:"primera_visita"===A?"nuevo_paciente":"seguimiento",patientData:a,sessionData:o});e=await B.generateReport(i),s="ai-generated",q("working"),console.log("✅ IA gener\xf3 informe exitosamente")}catch(t){console.warn("⚠️ Error IA, usando contenido estructurado:",t),q("fallback"),e=el(o,r),s="structured-fallback"}else e=el(o,r),s="structured-direct";console.log("\uD83D\uDCDD Informe generado con m\xe9todo:",s);let i=!1;try{if((t=await P.createPatientReport(o,e,p.name,p.id)).success)i=!0,Z("working"),console.log("\uD83D\uDCBE Informe guardado en Google Drive:",t.fileId);else throw Error(t.message)}catch(e){console.warn("⚠️ Error Google Drive:",e),Z("no-permissions"),t={fileId:"",webViewLink:"",success:!1,message:"Sin permisos de Google Drive"}}let n={user_id:a.id,patient_id:p.id,title:o,content:e,report_type:A,input_type:ea?"voice":Y.length>0?"mixed":"text",google_drive_file_id:t?.fileId||null,status:"completed",audio_transcription:M||void 0},l=await k.qi.create(n);if(console.log("\uD83D\uDCBD Informe guardado en base de datos:",l.id),i)try{await F.addReportToCRM({date:r,patientId:p.id,patientName:p.name,reportType:ed(A),title:o,status:"Completado",driveLink:t.webViewLink,inputMethod:`${s} + ${ea?"audio":Y.length>0?"archivos":"notas"}`});let e=await k.qi.getByPatient(p.id),a=await P.getPatientFolderUrl(p.name,p.id);await F.upsertPatientInCRM({id:p.id,name:p.name,email:p.email||void 0,phone:p.phone||void 0,birth_date:p.birth_date||void 0,created_at:p.created_at||new Date().toISOString(),total_reports:e.length+1,last_report_date:r,payment_status:"Pendiente",total_paid:0,status:"active",notes:p.notes||void 0,drive_folder_url:a||void 0}),console.log("\uD83D\uDCCA CRM actualizado exitosamente")}catch(e){console.warn("Error actualizando CRM (no cr\xedtico):",e)}let c=await k.qi.getByPatient(p.id);J(c),G(l.id);let d="";d="ai-generated"===s&&i?"\xa1Informe cl\xednico generado por IA y guardado en Google Drive exitosamente!":"ai-generated"===s?"\xa1Informe cl\xednico generado por IA exitosamente! (Guardado localmente - Google Drive no disponible)":i?"\xa1Informe estructurado creado y guardado en Google Drive exitosamente!":"\xa1Informe estructurado creado exitosamente! (Guardado localmente - Google Drive no disponible)",v.Am.success(d,{duration:6e3}),I(""),z(""),Q(),es()}catch(e){console.error("Error generating report:",e),v.Am.error(`Error al generar el informe: ${e instanceof Error?e.message:"Error desconocido"}`)}finally{$(!1)}},ed=e=>({primera_visita:"Informe Primera Visita",seguimiento:"Informe Seguimiento"})[e]||e,ep=e=>e?new Date(e).toLocaleDateString("es-ES"):"No especificada";return p?(0,r.jsxs)(r.Fragment,{children:[r.jsx(N.Z,{}),(0,r.jsxs)("div",{className:"container mx-auto max-w-6xl px-6 py-8 space-y-8",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("h1",{className:"font-lora text-3xl font-bold mb-2",children:["Registro de Sesi\xf3n - ",p.name]}),r.jsx("p",{className:"text-muted-foreground",children:"Sistema h\xedbrido de documentaci\xf3n cl\xednica con IA y fallbacks robustos"}),r.jsx("p",{className:`text-sm mt-1 ${"working"===U&&"working"===V?"text-green-600":"fallback"===U||"no-permissions"===V?"text-yellow-600":"text-gray-500"}`,children:"working"===U&&"working"===V?"IA + Google Drive operativos":"working"===U&&"no-permissions"===V?"IA operativa - Drive sin permisos":"fallback"===U&&"working"===V?"Informes estructurados + Google Drive":"fallback"===U&&"no-permissions"===V?"Informes estructurados - Drive sin permisos":"Estado del sistema: Verificando..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(i.Zb,{children:[r.jsx(i.Ol,{children:r.jsx(i.ll,{children:"Registro de la Sesi\xf3n"})}),(0,r.jsxs)(i.aY,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h3",{className:"font-semibold",children:"Grabaci\xf3n de Sesi\xf3n"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx(n.z,{onClick:ee?eo:er,variant:ee?"destructive":"default",size:"lg",className:"bg-primary hover:bg-primary/90",disabled:D,children:ee?(0,r.jsxs)(r.Fragment,{children:[r.jsx(u,{className:"w-4 h-4 mr-2"}),"Parar Grabaci\xf3n"]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(m,{className:"w-4 h-4 mr-2"}),"Empezar Grabaci\xf3n"]})}),ee&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),r.jsx("span",{className:"font-mono text-lg font-semibold",children:et})]}),D&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-600",children:[r.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full  animate-spin"}),r.jsx("span",{className:"text-sm",children:"working"===U?"Transcribiendo con Whisper...":"Procesando audio..."})]})]}),ea&&!ee&&r.jsx(i.Zb,{className:M.includes("Pendiente transcripci\xf3n manual")?"border-yellow-200 bg-yellow-50":"border-green-200 bg-green-50",children:r.jsx(i.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-medium",children:["Grabaci\xf3n finalizada - ",et]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:`${new Date().toLocaleDateString()}_${et}_${W}_session.wav`}),M&&!M.includes("Pendiente transcripci\xf3n manual")&&(0,r.jsxs)("p",{className:"text-xs text-green-700 mt-1",children:["✓ Transcrito autom\xe1ticamente (",M.length," caracteres)"]}),M&&M.includes("Pendiente transcripci\xf3n manual")&&r.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"⚠ Transcripci\xf3n autom\xe1tica no disponible - Informaci\xf3n b\xe1sica guardada"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(n.z,{variant:"outline",size:"sm",onClick:ei,children:r.jsx(m,{className:"w-4 h-4"})}),r.jsx(n.z,{variant:"outline",size:"sm",onClick:es,children:r.jsx(h.Z,{className:"w-4 h-4"})})]})]})})}),M&&r.jsx(i.Zb,{className:M.includes("Pendiente transcripci\xf3n manual")?"border-yellow-200 bg-yellow-50":"border-blue-200 bg-blue-50",children:(0,r.jsxs)(i.aY,{className:"p-4",children:[r.jsx("h4",{className:`font-medium mb-2 ${M.includes("Pendiente transcripci\xf3n manual")?"text-yellow-800":"text-blue-800"}`,children:M.includes("Pendiente transcripci\xf3n manual")?"Informaci\xf3n del Audio":"Transcripci\xf3n Autom\xe1tica"}),r.jsx("p",{className:`text-sm max-h-32 overflow-y-auto ${M.includes("Pendiente transcripci\xf3n manual")?"text-yellow-700":"text-blue-700"}`,children:M})]})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Notas Cl\xednicas"}),r.jsx(l.g,{placeholder:"Observaciones cl\xednicas, contexto de la sesi\xf3n, notas importantes...",value:E,onChange:e=>I(e.target.value),className:"min-h-[150px] resize-none"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Archivos Adicionales"}),r.jsx(S,{files:Y,onFilesSelected:K,onFileRemove:X,acceptedTypes:".wav,.mp3,.m4a,.txt,.pdf,.doc,.docx",maxFiles:5})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[r.jsx("strong",{children:"Contenido del informe:"})," ",(()=>{let e=[];return E.trim()&&e.push(`Notas (${E.length} chars)`),M.trim()&&e.push(`Transcripci\xf3n (${M.length} chars)`),Y.length>0&&e.push(`${Y.length} archivos`),e.join(" + ")||"Sin contenido"})()]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Sistema: ","working"===U?"IA disponible":"Informes estructurados"," | Drive: ","working"===V?"Conectado":"Sin permisos"]})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,r.jsxs)(n.z,{variant:"outline",size:"lg",onClick:()=>{let e={patient_id:p?.id,patient_name:p?.name,notes:E,transcription:M,files:Y.map(e=>e.name),hasRecording:!!ea,recordingDuration:et,timestamp:new Date().toISOString()};localStorage.setItem("session_draft",JSON.stringify(e)),v.Am.success("Borrador guardado localmente")},className:"flex items-center  gap-2",children:[r.jsx(g.Z,{className:"w-4 h-4"}),"Guardar Borrador"]}),r.jsx(n.z,{variant:"outline",size:"lg",onClick:()=>{try{let e=localStorage.getItem("session_draft");if(e){let t=JSON.parse(e);t.notes&&I(t.notes),t.transcription&&z(t.transcription),v.Am.success("Borrador cargado")}else v.Am.error("No hay borrador guardado")}catch(e){console.error("Error loading draft:",e),v.Am.error("Error al cargar el borrador")}},className:"flex items-center gap-2",children:"Cargar Borrador"}),(0,r.jsxs)(n.z,{size:"lg",onClick:ec,disabled:O||D,className:"bg-primary hover:bg-primary/90 flex items-center gap-2",children:[r.jsx(f,{className:"w-4 h-4"}),O?"Generando Informe...":"working"===U?"Generar con IA":"Generar Informe Estructurado"]})]}),("fallback"===U||"no-permissions"===V)&&r.jsx(i.Zb,{className:"border-yellow-200 bg-yellow-50",children:r.jsx(i.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx(x.Z,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("p",{className:"font-medium text-yellow-800",children:"Sistema funcionando en modo h\xedbrido"}),"fallback"===U&&r.jsx("p",{className:"text-yellow-700",children:"• IA no disponible - Usando informes estructurados profesionales"}),"no-permissions"===V&&r.jsx("p",{className:"text-yellow-700",children:"• Google Drive sin permisos - Informes guardados localmente"}),r.jsx("p",{className:"text-yellow-600 text-xs mt-1",children:"Los informes se crean correctamente independientemente del estado de los servicios externos."})]})]})})})]}),r.jsx("div",{className:"space-y-8",children:(0,r.jsxs)(i.Zb,{children:[r.jsx(i.Ol,{children:(0,r.jsxs)(i.ll,{className:"font-serif text-lg flex items-center",children:[r.jsx(d.Z,{className:"mr-2 h-5 w-5"}),"Actividad - Informes"]})}),r.jsx(i.aY,{className:"space-y-4",children:r.jsx("div",{className:"h-60 overflow-y-auto custom-scrollbar space-y-4 pr-2",children:H.length>0?H.map(e=>r.jsx("div",{className:"border rounded-lg p-4 hover:bg-muted/30 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-foreground text-sm leading-tight",children:e.title}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 mt-2 text-xs text-muted-foreground",children:[r.jsx(w.Z,{className:"h-3 w-3"}),r.jsx("span",{children:ep(e.created_at)}),r.jsx("span",{children:"•"}),r.jsx(c.C,{variant:"outline",className:"text-xs",children:"primera_visita"===e.report_type?"Primera Visita":"Seguimiento"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx(c.C,{variant:"completed"===e.status?"default":"secondary",className:"text-xs",children:"completed"===e.status?"Completado":"Borrador"}),e.google_drive_file_id&&r.jsx("a",{href:`https://docs.google.com/document/d/${e.google_drive_file_id}/edit`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 transition-colors",title:"Abrir informe en Google Drive",children:r.jsx(y.Z,{className:"h-4 w-4"})})]})]})},e.id)):(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx(d.Z,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Sin informes registrados"})]})})})]})})]})]})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(N.Z,{}),r.jsx("div",{className:"container mx-auto max-w-6xl px-6 py-8",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx(d.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Paciente no encontrado"}),r.jsx("p",{className:"text-muted-foreground mb-6",children:"El paciente especificado no existe o no tienes acceso a \xe9l."}),r.jsx(n.z,{onClick:()=>t.push("/patient-list"),children:"Volver a lista de pacientes"})]})})]})}},1215:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(2881).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},3354:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(8570).createProxy)(String.raw`D:\iNFORiA\SaaS\INFORIA2.0\app\(app)\session\[patientId]\page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,832,857,270,817,914,528,999,975,904],()=>a(3965));module.exports=r})();